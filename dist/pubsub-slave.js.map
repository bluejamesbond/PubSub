{"version":3,"sources":["../src/pubsub-slave.es6"],"names":[],"mappings":"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","file":"pubsub-slave.es6","sourcesContent":["import ipc from 'node-ipc';\nimport async from 'async';\nimport EventEmitter from 'events';\nimport Promise from 'bluebird';\nimport crypto from 'crypto';\n\nconst noop = () => 0;\n\nconst defaultEventMap = {\n  delimiter: '-',\n\n  // request events\n  requestBroadcast: 'broadcast',\n  requestEmit: 'emit',\n  requestServerAddress: 'get-server-address',\n  requestAddToken: 'add-token',\n  requestRemoveToken: 'remove-token',\n  requestAuthorization: 'authorize',\n  requestDeauthorization: 'deauthorize',\n  requestMasterEmit: 'slave-emit',\n  requestPeerBroadcast: 'broadcast-peer',\n  requestPeerEmit: 'emit-peer',\n\n  // response events\n  responseTokenAdded: 'token-added',\n  responseTokenRemoved: 'token-removed',\n  responseClientConnected: 'client-connected',\n  responseClientDisconnected: 'client-disconnected',\n  responseClientAwk: 'client-received',\n\n  responseMasterMessage: 'master-message',\n  responseMasterAwk: 'master-received',\n  responseSlaveReceived: 'slave-got',\n\n  responsePeerMessage: 'peer-message',\n  responsePeerReceived: 'peer-got',\n  responsePeerAwk: 'peer-received',\n\n  responseServerAddress: 'server-address'\n};\n\n// TODO\n// Client events: connect, disconnect, accept, reject\n// Peer events: connect, disconnect, channel\n// Master events: channel\n\nconst active = {};\n\nconst defaultOpts = {\n  resDefaultTimeout: 60000,\n  debug: false,\n  concurrency: 50,\n  scope: 'socket',\n  eventMap: defaultEventMap,\n  appspace: 'socket'\n};\n\nclass PubSubSlave extends EventEmitter {\n  constructor(origin, address, opts = defaultOpts) {\n    super();\n\n    opts = Object.assign(defaultOpts, opts);\n\n    this.origin = origin;\n    this.opts = opts;\n    this.scope = opts.scope;\n    this.eventMap = Object.assign(defaultEventMap, opts.eventMap);\n    this.remoteAddress = address;\n    this.remote = opts.remote;\n    this.resDefaultTimeout = opts.resDefaultTimeout;\n    this.debug = opts.debug;\n\n    this.setMaxListeners(Number.MAX_SAFE_INTEGER);\n\n    this.queue = async.queue((data, callback) => {\n      const _callback = () => process.nextTick(callback);\n      if (typeof data === 'function') {\n        if (data.length) {\n          data(_callback);\n        } else {\n          data();\n          _callback();\n        }\n\n        return;\n      }\n\n      this._handleTransmit(data, _callback);\n    }, opts.concurrency);\n\n    this.queue.pause();\n  }\n\n  Peer = {\n    broadcast: this._peerBroadcast.bind(this),\n    volatile: this._peerVolatile.bind(this),\n    emit: this._peerEmit.bind(this),\n    on: this._peerOn.bind(this),\n    removeListener: this._peerRemoveListener.bind(this),\n    once: this._peerOnce.bind(this)\n  };\n\n  Client = {\n    broadcast: this.broadcast.bind(this),\n    volatile: this.volatile.bind(this),\n    emit: this.emit.bind(this),\n    accept: this.accept.bind(this),\n    reject: this.reject.bind(this),\n    on: this._clientOn.bind(this),\n    removeListener: this._clientRemoveListener.bind(this),\n    once: this._clientOnce.bind(this)\n  };\n\n  Master = {\n    emit: this._masterEmit.bind(this),\n    on: this._masterOn.bind(this),\n    removeListener: this._masterRemoveListener.bind(this),\n    once: this._masterOnce.bind(this)\n  };\n\n  _clientOn(channel, ...args) {\n    return this.on(`client-${channel}`, ...args);\n  }\n\n  _clientOnce(channel, ...args) {\n    return this.once(`client-${channel}`, ...args);\n  }\n\n  _clientRemoveListener(channel, ...args) {\n    return this.removeListener(`client-${channel}`, ...args);\n  }\n\n  _masterOn(channel, ...args) {\n    return this.on(this.for(this.eventMap.responseMasterMessage, channel), ...args);\n  }\n\n  _masterOnce(channel, ...args) {\n    return this.on(this.for(this.eventMap.responseMasterMessage, channel), ...args);\n  }\n\n  _masterRemoveListener(channel, ...args) {\n    return this.on(this.for(this.eventMap.responseMasterMessage, channel), ...args);\n  }\n\n  _peerOn(channel, ...args) {\n    return this.on(this.for(this.eventMap.responsePeerMessage, channel), ...args);\n  }\n\n  _peerOnce(channel, ...args) {\n    return this.on(this.for(this.eventMap.responsePeerMessage, channel), ...args);\n  }\n\n  _peerRemoveListener(channel, ...args) {\n    return this.on(this.for(this.eventMap.responsePeerMessage, channel), ...args);\n  }\n\n  _masterEmit(channel, data, awk = true) {\n    if (!awk) {\n      return this.queue.push({action: this.eventMap.requestMasterEmit, channel, data});\n    }\n\n    return new Promise((resolve, reject) => {\n      this.queue.push({action: this.eventMap.requestMasterEmit, channel, data, awk, resolve, reject});\n    });\n  }\n\n  _peerBroadcast(channel, data) {\n    this.queue.push({channel, action: this.eventMap.requestPeerBroadcast, data, awk: true});\n  }\n\n  _peerVolatile(dest, channel, data) {\n    this._peerEmit(dest, channel, data, false);\n  }\n\n  _peerEmit(dest, channel, data, awk = true, resolve, reject) {\n    if (!awk) {\n      return this.queue.push({action: this.eventMap.requestPeerEmit, channel, data, dest});\n    }\n\n    if (typeof resolve === 'function' && typeof reject === 'function') {\n      return this.queue.push({action: this.eventMap.requestPeerEmit, channel, data, awk, dest, resolve, reject});\n    }\n\n    return new Promise((_resolve, _reject) => {\n      const req = {\n        action: this.eventMap.requestPeerEmit,\n        channel,\n        data,\n        awk,\n        dest,\n        resolve: _resolve,\n        reject: _reject\n      };\n\n      this.queue.push(req);\n    });\n  }\n\n  // private emit\n  _emit(...args) {\n    super.emit(...args);\n  }\n\n  resolveHost(address) {\n    let host = address.hostname || '0.0.0.0';\n\n    if (host === 'localhost' || host === '::1' || host === '127.0.0.1') {\n      host = '0.0.0.0';\n    }\n\n    return host;\n  }\n\n  resolvePort(address) {\n    return address.port;\n  }\n\n  configure(_ipc) {\n    noop(_ipc);\n  }\n\n  connect() {\n    const eventMap = this.eventMap;\n    const address = this.remoteAddress;\n\n    if (!active.hasOwnProperty(this.scope)) {\n      active[this.scope] = {};\n    }\n\n    active[this.scope] = {[this.origin]: true};\n\n    ipc.config.retry = 5000;\n    ipc.config.maxRetries = 20;\n    ipc.config.silent = !this.debug;\n    ipc.config.networkHost = this.resolveHost(address);\n    ipc.config.networkPort = this.resolvePort(address);\n    ipc.config.appspace = this.opts.master || this.opts.appspace;\n\n    this.configure(ipc);\n\n    return new Promise(resolve => {\n      ipc[this.remote ? 'connectToNet' : 'connectTo'](this.scope, () => {\n        ipc.config.stopRetrying = false;\n        resolve();\n\n        this.queue.unshift(() => {\n          const req = {\n            id: this.origin,\n            data: {origin: this.origin}\n          };\n\n          this._emitIPC(this.eventMap.requestAuthorization, req);\n        });\n\n        this.queue.resume();\n      });\n\n      ipc.of[this.scope].on('disconnect', () => {\n        this.queue.pause();\n      });\n\n      ipc.of[this.scope].on(eventMap.responseTokenAdded, data => {\n        if (data.dest !== this.origin) {\n          return;\n        }\n\n        data = this.unwrap(data, eventMap.responseTokenAdded).data;\n\n        this._emit(eventMap.responseTokenAdded, data);\n        this._emit(this.for(eventMap.responseTokenAdded, data.token), data);\n      });\n\n      ipc.of[this.scope].on(eventMap.responseServerAddress, data => {\n        if (data.dest !== this.origin) {\n          return;\n        }\n\n        data = this.unwrap(data, eventMap.responseServerAddress).data;\n\n        this._emit(eventMap.responseServerAddress, data);\n      });\n\n      ipc.of[this.scope].on(eventMap.responseTokenRemoved, data => {\n        if (data.dest !== this.origin) {\n          return;\n        }\n\n        data = this.unwrap(data, eventMap.responseTokenRemoved).data;\n\n        this._emit(eventMap.responseTokenRemoved, data);\n        this._emit(this.for(eventMap.responseTokenRemoved, data.token), data);\n        this._emit(`client-reject-${data.token}`, data.token);\n        this._emit(`client-reject`, data.token);\n      });\n\n      ipc.of[this.scope].on(eventMap.responseClientAwk, data => {\n        if (data.dest !== this.origin) {\n          return;\n        }\n\n        data = this.unwrap(data, eventMap.responseClientAwk).data;\n\n        this._emit(eventMap.responseClientAwk, data);\n        this._emit(this.for(eventMap.responseClientAwk, data.id), data);\n      });\n\n      ipc.of[this.scope].on(eventMap.responsePeerAwk, data => {\n        if (data.dest !== this.origin) {\n          return;\n        }\n\n        data = this.unwrap(data, eventMap.responsePeerAwk).data;\n\n        this._emit(eventMap.responsePeerAwk, data);\n        this._emit(this.for(eventMap.responsePeerAwk, data.id), data);\n      });\n\n      ipc.of[this.scope].on(eventMap.responseMasterAwk, data => {\n        if (data.dest !== this.origin) {\n          return;\n        }\n\n        data = this.unwrap(data, eventMap.responseMasterAwk).data;\n\n        this._emit(eventMap.responseMasterAwk, data);\n        this._emit(this.for(eventMap.responseMasterAwk, data.id), data);\n      });\n\n      ipc.of[this.scope].on(eventMap.responseClientConnected, data => {\n        if (data.dest !== this.origin) {\n          return;\n        }\n\n        data = this.unwrap(data, eventMap.responseClientConnected).data;\n\n        this._emit(eventMap.responseClientConnected, data);\n        this._emit(this.for(eventMap.responseClientConnected, data.token), data);\n        this._emit(`client-connect-${data.token}`, data.token);\n        this._emit(`client-connect`, data.token);\n      });\n\n      ipc.of[this.scope].on(eventMap.responsePeerMessage, data => {\n        if (data.dest !== this.origin) {\n          return;\n        }\n\n        data = this.unwrap(data, eventMap.responsePeerMessage).data;\n\n        let v = 0;\n        const respond = res => {\n          if (v++) return;\n          const response = {id: this.origin, data: {...data, _data: data.data, data: res}};\n          this.queue.push(() => this._emitIPC(eventMap.responsePeerReceived, response));\n        };\n\n        this._emit(eventMap.responsePeerMessage, data.from, data, respond);\n        this._emit(this.for(eventMap.responsePeerMessage, data.channel), data.from, data.data, respond);\n      });\n\n      ipc.of[this.scope].on(eventMap.responseMasterMessage, data => {\n        if (data.dest !== this.origin) {\n          return;\n        }\n\n        data = this.unwrap(data, eventMap.responseMasterMessage).data;\n\n        let v = 0;\n        const respond = res => {\n          if (v++) return;\n          const response = {id: this.origin, data: {...data, _data: data.data, data: res}};\n          this.queue.push(() => this._emitIPC(eventMap.responseSlaveReceived, response));\n        };\n\n        this._emit(eventMap.responseMasterMessage, data, respond);\n        this._emit(this.for(eventMap.responseMasterMessage, data.channel), data.data, respond);\n      });\n\n      ipc.of[this.scope].on(eventMap.responseClientDisconnected, data => {\n        data = this.unwrap(data, eventMap.responseClientDisconnected).data;\n\n        this._emit(eventMap.responseClientDisconnected, data);\n        this._emit(this.for(eventMap.responseClientDisconnected, data.token), data);\n        this._emit(`client-disconnect-${data.token}`, data.token);\n        this._emit(`client-disconnect`, data.token);\n      });\n    });\n  }\n\n  _generateUUID() {\n    return crypto.randomBytes(10).toString('hex');\n  }\n\n  unwrap(data) {\n    return data || {data: {}};\n  }\n\n  wrap(data) {\n    return data;\n  }\n\n  _handleTransmit({token, dest, channel, data, resolve, action, reject, awk}, callback) {\n    const eventMap = this.eventMap;\n    const eventId = this._generateUUID();\n\n    if (action === this.eventMap.requestBroadcast ||\n      action === this.eventMap.requestPeerBroadcast) {\n      const req = {\n        id: this.origin,\n        data: {\n          dest,\n          id: eventId,\n          token,\n          channel,\n          data,\n          awk\n        }\n      };\n\n      this._emitIPC(action, req);\n\n      return callback();\n    }\n\n    let tid;\n    let event;\n\n    const accepted = res => {\n      clearTimeout(tid);\n      resolve(res.data);\n    };\n\n    const timeout = () => {\n      this.removeListener(event, accepted);\n      reject({token, channel, data, awk});\n    };\n\n    let awkChan;\n\n    if (action === eventMap.requestEmit) {\n      awkChan = eventMap.responseClientAwk;\n    } else if (action === eventMap.requestPeerEmit) {\n      awkChan = eventMap.responsePeerAwk;\n    } else if (eventMap.requestMasterEmit) {\n      awkChan = eventMap.responseMasterAwk;\n    }\n\n    if (awk) {\n      event = this.for(awkChan, eventId);\n\n      const wait = typeof awk === 'number' && awk > 0 ? awk : this.resDefaultTimeout;\n\n      this.once(event, accepted);\n      tid = setTimeout(timeout, wait);\n    }\n\n    const req = {\n      id: this.origin,\n      data: {\n        dest,\n        id: eventId,\n        token,\n        channel,\n        data,\n        awk\n      }\n    };\n\n    this._emitIPC(action, req);\n\n    callback();\n  }\n\n  for(event, id) {\n    return [event, id].join(this.eventMap.delimiter);\n  }\n\n  _emitIPC(event, data) {\n    ipc.of[this.scope].emit(event, this.wrap(data, event));\n  }\n\n  accept(token) {\n    const eventMap = this.eventMap;\n\n    return new Promise(resolve => {\n      if (eventMap.responseTokenAdded) {\n        this.once(this.for(eventMap.responseTokenAdded, token), data => resolve(data));\n      }\n\n      const req = {\n        id: this.origin,\n        data: {token}\n      };\n\n      this._emitIPC(eventMap.requestAddToken, req);\n\n      if (!eventMap.responseTokenAdded) {\n        resolve(token);\n      }\n    });\n  }\n\n  reject(token) {\n    const eventMap = this.eventMap;\n\n    return new Promise(resolve => {\n      if (eventMap.responseTokenRemoved) {\n        this.once(this.for(eventMap.responseTokenRemoved, token), () => {\n          resolve(token);\n        });\n      }\n\n      const req = {\n        id: this.origin,\n        data: {token}\n      };\n\n      this._emitIPC(eventMap.requestRemoveToken, req);\n\n      if (!eventMap.responseTokenRemoved) {\n        resolve(token);\n      }\n    });\n  }\n\n  volatile(token, channel, data) {\n    return this.emit(token, channel, data, false);\n  }\n\n  emit(token, channel, data, awk = true, resolve, reject) {\n    if (!awk) {\n      return this.queue.push({token, action: this.eventMap.requestEmit, channel, data});\n    }\n\n    if (typeof resolve === 'function' && typeof reject === 'function') {\n      return this.queue.push({token, action: this.eventMap.requestEmit, channel, data, awk, resolve, reject});\n    }\n\n    return new Promise((_resolve, _reject) => {\n      const req = {\n        token,\n        action: this.eventMap.requestEmit,\n        channel,\n        data,\n        awk,\n        resolve: _resolve,\n        reject: _reject\n      };\n\n      this.queue.push(req);\n    });\n  }\n\n  address() {\n    if (!this._address) {\n      this._address = new Promise(resolve => {\n        this.queue.push(callback => {\n          this.once(this.eventMap.responseServerAddress, _address => resolve(_address));\n\n          const req = {\n            id: this.origin,\n            data: {}\n          };\n\n          this._emitIPC(this.eventMap.requestServerAddress, req);\n          callback();\n        });\n      });\n    }\n\n    return this._address;\n  }\n\n  broadcast(channel, data) {\n    this.queue.push({channel, action: this.eventMap.requestBroadcast, data, awk: true});\n  }\n\n  disconnect() {\n    if (active.hasOwnProperty(this.scope)) {\n      delete active[this.scope][this.origin];\n\n      const sync = ipc.config.sync;\n      ipc.config.sync = true;\n\n      // bypass queue\n      try {\n        ipc.of[this.scope].emit(this.eventMap.requestDeauthorization, {id: this.origin, data: {origin: this.origin}});\n      } catch (e) {\n        // ignore\n      }\n\n      ipc.config.sync = sync;\n\n      if (!active[this.scope].length) {\n        ipc.disconnect(this.scope);\n      }\n    }\n  }\n\n  isRemote() {\n    return this.remote;\n  }\n\n  isLocal() {\n    return !this.remote;\n  }\n}\n\nexport default PubSubSlave;\n"]}