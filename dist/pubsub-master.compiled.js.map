{"version":3,"sources":["pubsub-master.es6"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;IAIM;AACJ,WADI,YACJ,CAAY,MAAZ,EAA+B;QAAX,6DAAO,kBAAI;;0BAD3B,cAC2B;;AAC7B,SAAK,MAAL,GAAc,MAAd,CAD6B;AAE7B,SAAK,IAAL,GAAY,IAAZ,CAF6B;;AAI7B,SAAK,KAAL,GAAa,oBAAa,KAAK,KAAL,CAA1B,CAJ6B;AAK7B,SAAK,MAAL,GAAc,oBAAY,KAAK,MAAL,EAAa,IAAzB,CAAd,CAL6B;GAA/B;;eADI;;2BASG,QAAQ,OAAO,IAAI;;;AACxB,WAAK,KAAL,CAAW,MAAX,CAAkB,KAAK,MAAL,CAAlB,CADwB;;AAGxB,WAAK,MAAL,CAAY,EAAZ,CAAe,WAAf,EAA4B,UAAC,MAAD,EAAS,IAAT;eAAkB,MAAK,KAAL,CAAW,MAAX,CAAkB,MAAlB,EAA0B,KAAK,KAAL;OAA5C,CAA5B,CAHwB;AAIxB,WAAK,MAAL,CAAY,EAAZ,CAAe,cAAf,EAA+B,UAAC,MAAD,EAAS,IAAT;eAAkB,MAAK,KAAL,CAAW,MAAX,CAAkB,MAAlB,EAA0B,KAAK,KAAL;OAA5C,CAA/B,CAJwB;AAKxB,WAAK,MAAL,CAAY,EAAZ,CAAe,WAAf,EAA4B,UAAC,MAAD,EAAS,IAAT;eAAkB,MAAK,KAAL,CAAW,SAAX,CAAqB,MAArB,EAA6B,KAAK,OAAL,EAAc,KAAK,IAAL;OAA7D,CAA5B,CALwB;AAMxB,WAAK,MAAL,CAAY,EAAZ,CAAe,MAAf,EACe,UAAC,MAAD,EAAS,IAAT;eAAkB,MAAK,KAAL,CAAW,IAAX,CAAgB,MAAhB,EAAwB,KAAK,KAAL,EAAY,KAAK,OAAL,EAAc,KAAK,EAAL,EAAS,KAAK,IAAL,EAAW,KAAK,GAAL;OAAxF,CADf,CANwB;AAQxB,WAAK,MAAL,CAAY,EAAZ,CAAe,oBAAf,EACe;eAAU,uBAAQ,MAAK,MAAL,EAAa,MAAK,IAAL,CAAU,MAAV,CAArB,CACT,IADS,CACJ;iBAAK,MAAK,MAAL,CAAY,IAAZ,CAAiB,MAAjB,EAAyB,gBAAzB,EAA2C,CAA3C;SAAL;OADN,CADf,CARwB;;AAYxB,WAAK,KAAL,CAAW,EAAX,CAAc,iBAAd,EAAiC,UAAC,MAAD,EAAS,IAAT;eAAkB,MAAK,MAAL,CAAY,IAAZ,CAAiB,MAAjB,EAAyB,iBAAzB,EAA4C,IAA5C;OAAlB,CAAjC,CAZwB;AAaxB,WAAK,KAAL,CAAW,EAAX,CAAc,qBAAd,EAAqC,UAAC,MAAD,EAAS,IAAT;eAAkB,MAAK,MAAL,CAAY,IAAZ,CAAiB,MAAjB,EAAyB,qBAAzB,EAAgD,IAAhD;OAAlB,CAArC,CAbwB;AAcxB,WAAK,KAAL,CAAW,EAAX,CAAc,aAAd,EAA6B,UAAC,MAAD,EAAS,IAAT;eAAkB,MAAK,MAAL,CAAY,IAAZ,CAAiB,MAAjB,EAAyB,aAAzB,EAAwC,IAAxC;OAAlB,CAA7B,CAdwB;AAexB,WAAK,KAAL,CAAW,EAAX,CAAc,eAAd,EAA+B,UAAC,MAAD,EAAS,IAAT;eAAkB,MAAK,MAAL,CAAY,IAAZ,CAAiB,MAAjB,EAAyB,eAAzB,EAA0C,IAA1C;OAAlB,CAA/B,CAfwB;;AAiBxB,WAAK,MAAL,CAAY,MAAZ,CAAmB,MAAnB,EAA2B;eAAM,MAAK,MAAL,CAAY,MAAZ,CAAmB,KAAnB,EAA0B,EAA1B;OAAN,CAA3B,CAjBwB;;;;SATtB;;;kBA8BS","file":"pubsub-master.es6","sourcesContent":["import {SocketIO} from './slave/index.es6';\nimport {NodeIPC} from './master/index.es6';\nimport address from './libs/address.es6';\n\nclass PubSubMaster {\n  constructor(server, opts = {}) {\n    this.server = server;\n    this.opts = opts;\n\n    this.slave = new SocketIO(opts.debug);\n    this.master = new NodeIPC(opts.remote, opts);\n  }\n\n  listen(master, slave, cb) {\n    this.slave.attach(this.server);\n\n    this.master.on('add-token', (origin, data) => this.slave.accept(origin, data.token));\n    this.master.on('remove-token', (origin, data) => this.slave.reject(origin, data.token));\n    this.master.on('broadcast', (origin, data) => this.slave.broadcast(origin, data.channel, data.data));\n    this.master.on('emit',\n                   (origin, data) => this.slave.emit(origin, data.token, data.channel, data.id, data.data, data.awk));\n    this.master.on('get-server-address',\n                   origin => address(this.server, this.opts.remote)\n                   .then(a => this.master.emit(origin, 'server-address', a)));\n\n    this.slave.on('client-received', (origin, data) => this.master.emit(origin, 'client-received', data));\n    this.slave.on('client-disconnected', (origin, data) => this.master.emit(origin, 'client-disconnected', data));\n    this.slave.on('token-added', (origin, data) => this.master.emit(origin, 'token-added', data));\n    this.slave.on('token-removed', (origin, data) => this.master.emit(origin, 'token-removed', data));\n\n    this.master.listen(master, () => this.server.listen(slave, cb));\n  }\n}\n\nexport default PubSubMaster;\n"]}